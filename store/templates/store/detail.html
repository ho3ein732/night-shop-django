{% extends 'parent/base.html' %}
{% load static %}
{% block content %}
		<!-- End Header -->
		<main class="main mt-8 single-product rtl text-right">
			<div class="page-content mb-10 pb-6">
				<div class="container">
					<div class="product product-single row mb-8">
						<div class="col-md-6">
							<div class="product-gallery pg-vertical ltr">
								<div class="product-label-group">
									<label class="product-label label-new">جدید</label>
									<label class="product-label label-sale">%{{ product.discount }} تخفیف</label>
								</div>
								<div class="product-single-carousel owl-carousel owl-theme owl-nav-inner row cols-1 ltr">
                                    {% for image in product.images.all %}
									<figure class="product-image">
										<img src="{{ image.file.url }}"
											data-zoom-image="{{ image.file.url }}"
											alt="کوله پشتی چرم قهوه ای زنانه" width="800" height="900">
									</figure>
                                    {% empty %}
                                        <figure class="product-image">
                                            <img src="{% static 'images/all.jpg' %}"
											data-zoom-image="{% static 'images/all.jpg' %}"
											alt="کوله پشتی چرم قهوه ای زنانه" width="800" height="900">
									</figure>
                                    {% endfor %}
								</div>
								<div class="product-thumbs-wrap ltr">
									<div class="product-thumbs">
                                        {% for image in product.images.all %}
                                            <div class="product-thumb {% if image.is_main %}active{% endif %}">
											    <img src="{{ image.file.url }}" alt="product thumbnail"
                                                    width="109" height="122">
										    </div>
                                        {% endfor %}
									</div>
									<button class="thumb-up disabled"><i class="fas fa-chevron-right"></i></button>
									<button class="thumb-down disabled"><i class="fas fa-chevron-left"></i></button>
								</div>
							</div>
						</div>
						<div class="col-md-6">
							<div class="product-details rtl">
								<div class="product-navigation">
									<ul class="breadcrumb breadcrumb-lg">
										<li><a href="{% url 'store:index' %}"><i class="d-icon-home"></i></a></li>
										<li><a href="#" class="active">محصول</a></li>
										<li>نمایش ویژه محصول</li>
									</ul>
								</div>
								<h1 class="product-name">{{ product.name }}</h1>
								<div class="product-meta">
									کد کالا:<span class="product-sku">{{ product.id }}</span>
									برند:<span class="product-brand">{{ product.brand }}</span>
								</div>
								<div class="product-price">
									<span class="price"> {{ product.price}} تومان</span>
								</div>
								<div class="ratings-container">
									<div class="ratings-full">
										<span class="ratings" style="width:20%"></span>
										<span class="tooltiptext tooltip-top"></span>
									</div>
									<a href="#product-tab-reviews" class="link-to-tab rating-reviews">{{ product.reviews.count }}</a>
								</div>
								<p class="product-short-desc">
                                    {{ product.description }}
                                </p>
								<div class="product-form product-variations product-size">
									<label>سایز:</label>
									<div class="product-form-group">
										<div class="select-box">
											<select name="size" class="form-control">
												<option value="">یک گزینه را انتخاب کنید</option>
                                                <option selected="selected">اصلی</option>
											</select>
										</div>
									</div>
								</div>
								<hr class="product-divider">
<div class="product-form product-qty">
    <div class="product-form-group">
        <button
            class="btn-product btn-cart text-normal ls-normal font-weight-semi-bold add-to-cart"
            data-product-id="{{ product.id }}">
            <i class="d-icon-bag"></i> اضافه به سبد خرید
        </button>
        <span class="success-message" style="display: none; color: green; font-weight: bold;">
            محصول به سبد خرید اضافه شد.
        </span>
    </div>
</div>


								<hr class="product-divider d-lg-show mb-3">
								<div class="product-footer">
									<div class="social-links ml-4">
										<a href="#" class="social-link social-facebook fab fa-facebook-f"></a>
										<a href="#" class="social-link social-twitter fab fa-twitter"></a>
										<a href="#" class="social-link social-pinterest fab fa-pinterest-p"></a>
									</div>
									<span class="divider d-lg-show"></span>
									<div class="product-action">
										<a href="#" class="btn-product btn-wishlist ml-6" data-product-id="{{ product.id }}"><i
												class="d-icon-heart"></i>
											علاقه مندی</a>

									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="tab tab-nav-simple product-tabs mb-4">
						<ul class="nav nav-tabs justify-content-center" role="tablist">
							<li class="nav-item">
								<a class="nav-link active" href="#product-tab-description">توضیحات</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#product-tab-additional">اطلاعات بیشتر</a>
							</li>

						</ul>
						<div class="tab-content">
							<div class="tab-pane active in" id="product-tab-description">
								<div class="row mt-6">
									<div class="col-md-6">
										<h5 class="description-title mb-4 font-weight-semi-bold ls-m">
											امکانات
										</h5>
										<p class="mb-2">
                                            {{ product.description }}
                                        </p>
										<ul class="mb-8">
                                            {% for feather in product.features.all %}
											<li> {{ feather }}</li>
                                            {% endfor %}
										</ul>
										<h5 class="description-title mb-3 font-weight-semi-bold ls-m">
											مشخصات فنی
										</h5>
										<table class="table">
											<tbody>
												<tr>
													<th class="font-weight-semi-bold text-dark pl-0">
														مواد :
													</th>
													<td class="pl-4">{{ product.material }} </td>
												</tr>
												<tr>
													<th class="font-weight-semi-bold text-dark pl-0">سایز :</th>
													<td class="pl-4"> بزرگ ، متوسط ، کوچک</td>
												</tr>
												<tr>
													<th class="font-weight-semi-bold text-dark pl-0">توصیه شده :</th>
													<td class="pl-4"> تجربه‌ای بی‌نظیر در انتظار شماست</td>
												</tr>
												<tr>
													<th class="font-weight-semi-bold text-dark border-no pl-0">سازنده :</th>
													<td class="border-no pl-4">گروه صنعتی الماس شب ملایر</td>
												</tr>
											</tbody>
										</table>
									</div>
									<div class="col-md-6 pl-md-6 pt-4 pt-md-0">
										<h5 class="description-title font-weight-semi-bold ls-m mb-5"> ویدئو توضیحات
										</h5>
										<figure class="p-relative d-inline-block mb-3">
											<img src="{% static 'images/product.jpg' %}" width="559" height="370"
												alt="Product" />
											<a class="btn-play btn-iframe" href="video/memory-of-a-woman.mp4">
												<i class="d-icon-play-solid"></i>
											</a>
										</figure>
										<div class="icon-box-wrap d-flex flex-wrap">
											<div class="icon-box icon-box-side icon-border pt-2 pb-2 mb-4 ml-10">
												<div class="icon-box-icon">
													<i class="d-icon-lock"></i>
												</div>
												<div class="icon-box-content rtl">
													<h4 class="icon-box-title lh-1 pt-1 ls-s text-normal">1سال
														گارانتی</h4>
													<p>تضمین  بدون قید و شرط</p>
												</div>
											</div>
											<div class="divider d-xl-show ml-10"></div>
											<div class="icon-box icon-box-side icon-border pt-2 pb-2 mb-4">
												<div class="icon-box-icon">
													<i class="d-icon-truck"></i>
												</div>
												<div class="icon-box-content rtl">
													<h4 class="icon-box-title lh-1 pt-1 ls-s text-normal">حمل و نقل رایگان
													</h4>
													<p>با خرید هر دو عدد کالا </p>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="tab-pane" id="product-tab-additional">
								<ul class="list-none">
									<li><label>برند:</label>
										<p>گروه صنعتی و تولیدی الماس شب</p>
									</li>
									<li><label>سایز:</label>
										<p>بزرگ, متوسط, کوچک</p>
									</li>
								</ul>
							</div>
							<div class="tab-pane" id="product-tab-reviews">
								<div class="row">
									<div class="col-lg-4 mb-6">
										<div class="avg-rating-container">
											<mark>5.0</mark>
											<div class="avg-rating">
												<span class="avg-rating-title">میانگین امتیاز</span>
												<div class="ratings-container mb-0">
													<div class="ratings-full">
														<span class="ratings" style="width:100%"></span>
														<span class="tooltiptext tooltip-top"></span>
													</div>
													<span class="rating-reviews">(از {{ product.reviews.count }} نظر)</span>
												</div>
											</div>
										</div>
										<div class="ratings-list mb-2">
                                            {% for rating in ratings %}
											<div class="ratings-item">
												<div class="ratings-container mb-0">
													<div class="ratings-full">
														<span class="ratings" style="width:100%"></span>
														<span class="tooltiptext tooltip-top"></span>
													</div>
												</div>
												<div class="rating-percent">
													<span style="width:100%;"></span>
												</div>
												<div class="progress-value">100%</div>
											</div>
                                            {% endfor %}
										</div>
                                    {% if not user.is_authenticated  %}
                                        <a class="btn btn-dark btn-rounded " href="{% url 'account:login' %}?next={{ request.path }}">برای ارسال نظر وارد شوید</a>
                                    <!-- ارسال نظر -->
                                        {% else %}
                                        <a class="btn btn-dark btn-rounded submit-review-toggle" href="#">ارسال
											بررسی ها</a>
                                    {% endif %}
									</div>
                                
									<div class="col-lg-8 comments pt-2 pb-10 border-no">
										<ul class="comments-list">
                                            {% for review in reviews %}
											<li>
												<div class="comment">
													<figure class="comment-media">
														<a href="#">
															<img src="{% static 'images/اواتار.jpg' %}" alt="avatar">
														</a>
													</figure>
													<div class="comment-body">
														<div class="comment-rating ratings-container">
															<div class="ratings-full">
																<span class="ratings" style="width:100%"></span>
																<span class="tooltiptext tooltip-top"></span>
															</div>
														</div>
														<div class="comment-user">
															<span class="comment-date">نویسنده :   <span
																	class="font-weight-semi-bold text-uppercase text-dark">{{ review.user.username }}</span> در
																<span class="font-weight-semi-bold text-dark">
																	{{ review.created_at|date:"d F Y" }}</span></span>
														</div>
														<div class="comment-content mb-5">
															<p>{{ review.comment }}</p>
														</div>
														<div class="feeling mt-5">
															<button
																class="btn btn-link btn-icon-left btn-slide-up btn-infinite like ml-2">
																<i class="fa fa-thumbs-up"></i>
																لایک (<span class="count">{{ review.like.count }}</span>)
															</button>
															<button
																class="btn btn-link btn-icon-left btn-slide-down btn-infinite unlike">
																<i class="fa fa-thumbs-down"></i>
																آنلایک (<span class="count">{{ review.unlike.count }}</span>)
															</button>
														</div>
													</div>
												</div>
											</li>
                                                {% empty %}
                                                <li>هیج نظری برای این محصول ثبت نشده است</li>
                                            {% endfor %}

										</ul>
									</div>
								</div>
								<!-- End Comment  -->

                            {% if not user.is_authenticated  %}

                            {% else %}
                                <div class="review-form-section">
                                    <div class="review-overlay"></div>
                                    <div class="review-form-wrapper">
                                        <div class="title-wrapper text-right">
                                            <h3 class="title title-simple text-right text-normal">ارسال نظر</h3>
                                        </div>
                                        <form method="post">
                                            {% csrf_token %}
                                            {{ form.as_p }}
                                            <button type="submit" class="btn btn-primary btn-rounded">ارسال<i class="d-icon-arrow-left"></i></button>
                                        </form>
                                    </div>
                                </div>
                            {% endif %}

								<!-- End Reply -->
							</div>
						</div>
					</div>
					<section class="pt-3 mt-10">
						<h2 class="title justify-content-center">محصولات مرتبط</h2>
						<div class="owl-carousel owl-theme owl-nav-full row cols-2 cols-md-3 cols-lg-4"
							data-owl-options="{
							 'rtl':true,
							'items': 5,
							'nav': false,
							'loop': false,
							'dots': true,
							'margin': 20,
							'responsive': {
								'0': {
									'items': 2
								},
								'768': {
									'items': 3
								},
								'992': {
									'items': 4,
									'dots': false,
									'nav': true
								}
							}
						}">
                            {% for item in related_products %}
							<div class="product shadow-media">
								<figure class="product-media">
									<a href="{{ item.get_absolute_url }}">
										<img src="{{ item.images.first.file.url }}" alt="product" width="280" height="315">
									</a>
                                    {% if item.is_new %}
									<div class="product-label-group">
										<label class="product-label label-new">جدید</label>
									</div>
                                    {% endif %}
									<div class="product-action-vertical">
										<a href="#" class="btn-product-icon btn-cart" data-toggle="modal"
											data-target="#addCartModal" title="اضافه به خرید"><i
												class="d-icon-bag"></i></a>
										<a href="#" class="btn-product-icon btn-wishlist" title="اضافه به علاقه مندی"><i
												class="d-icon-heart"></i></a>
									</div>
									<div class="product-action">
										<a href="{{ item.get_absolute_url }}" class="btn-product" title="مشاهده و انتخاب ">مشاهده و انتخاب </a>
									</div>
								</figure>
								<div class="product-details rtl">
									<div class="product-cat">
										<a href="{% url 'store:product_by_category' category_id=item.category.id  slug=item.category.slug %}">{{ item.category.name }}</a>
									</div>
									<h3 class="product-name">
										<a href="{{ item.get_absolute.url }}">{{ item.name }}</a>
									</h3>
									<div class="product-price">
										<span class="price"> {{ item.new_price}} تومان </span>
									</div>
									<div class="ratings-container">

										<a href="#" class="rating-reviews">( <span class="review-count">{{ item.sell }}</span>
											فروش
											)</a>
									</div>
								</div>
							</div>
                            {% endfor %}

						</div>
					</section>
				</div>
			</div>
		</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        // اضافه کردن به سبد خرید
        $('.btn-cart').click(function (e) {
            e.preventDefault();
            var button = $(this);
            var productId = button.data('product-id');

            $.ajax({
                type: 'POST',
                url: '{% url "cart:add-to-cart" 0 %}'.replace('0', productId),
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function (data) {
                    // به‌روزرسانی سبد خرید
                    $('.reload').load(location.href + " .reload");
                    $('.price-total-1').text(data.total_price)
                },
                error: function (xhr) {
                    var response = JSON.parse(xhr.responseText);
                    console.log(response.error || "خطایی رخ داده است.");
                }
            });
        });

        // حذف از سبد خرید
        $(document).on('click', '.remove_item', function (e) {
            e.preventDefault();
            var button = $(this);
            var productId = button.data('product-id');

            $.ajax({
                type: 'POST',
                url: '{% url "cart:remove-item" %}',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'item_id': productId
                },
                success: function (data) {
                    if (data.success) {
                        button.closest('.product').remove();
                        $('.price-total-1').text(data.total_price)


                        if (data.item_count === 0) {
                            $('.reload').html('<p>سبد خرید شما خالی است</p>');
                        }
                    } else {
                        console.log(data.error || "خطایی رخ داده است.");
                    }
                },
                error: function (xhr) {
                    console.log("خطایی رخ داده است.");
                }
            });
        });
        $('.btn-wishlist').click(function () {
        var button = $(this);
        var product_id = button.data('product-id')

            $.ajax({
               url: '{% url 'store:add_to-favorite' 0 %}'.replace('0', product_id),
                data: {'csrfmiddlewaretoken': '{{ csrf_token }}'},
                success: function () {
                   console.log('success')
                },
                error: function (error) {
                   console.log(error)
                },
            });
        });
    });
</script>

{% endblock %}